# 邮件服务配置指南

本系统支持多种邮件服务提供商，用于发送注册验证码和密码重置邮件。

## 配置选项

### 1. SMTP（推荐用于个人项目）

适用于：Gmail、Outlook、QQ邮箱等

```env
EMAIL_PROVIDER=smtp
EMAIL_FROM=your-email@gmail.com
EMAIL_FROM_NAME=优雅记事本
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
```

#### Gmail配置示例：
1. 开启两步验证
2. 生成应用专用密码
3. 使用应用专用密码作为 `SMTP_PASS`

#### QQ邮箱配置示例：
```env
SMTP_HOST=smtp.qq.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-qq-email@qq.com
SMTP_PASS=your-authorization-code
```

### 2. SendGrid（推荐用于生产环境）

适用于：高可靠性的商业邮件发送

```env
EMAIL_PROVIDER=sendgrid
EMAIL_FROM=noreply@yourdomain.com
EMAIL_FROM_NAME=优雅记事本
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxx
```

设置步骤：
1. 注册 [SendGrid](https://sendgrid.com) 账号
2. 创建API密钥
3. 验证发送域名
4. 配置环境变量

### 3. AWS SES（推荐用于AWS部署）

适用于：已使用AWS服务的项目

```env
EMAIL_PROVIDER=aws-ses
EMAIL_FROM=noreply@yourdomain.com
EMAIL_FROM_NAME=优雅记事本
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
```

设置步骤：
1. 在AWS SES控制台验证邮箱/域名
2. 申请移出沙盒模式（可选）
3. 创建IAM用户并分配SES权限
4. 配置访问密钥

## 开发环境

开发环境下，系统会在控制台输出邮件内容，无需配置真实邮件服务：

```
=== 开发环境模拟邮件发送 ===
收件人: user@example.com
主题: 优雅记事本 - 注册验证码
内容: 您的验证码是：123456
========================
```

## 生产环境配置

### 方案1：使用免费Gmail（小规模）
- 成本：免费
- 限制：每日500封邮件
- 适用：个人项目、小规模应用

### 方案2：使用SendGrid（推荐）
- 成本：免费层级每月100封，付费版本更多
- 限制：需要域名验证
- 适用：商业项目、需要高送达率

### 方案3：使用AWS SES
- 成本：按使用量付费，极低成本
- 限制：需要AWS账号
- 适用：已在使用AWS的项目

## 常见问题

### 1. Gmail "应用专用密码"设置
1. 登录Google账号 → 安全性
2. 开启两步验证
3. 应用专用密码 → 生成密码
4. 使用生成的16位密码

### 2. 邮件发送失败
- 检查SMTP配置是否正确
- 确认邮箱密码是应用专用密码
- 检查防火墙是否阻止SMTP端口

### 3. 邮件被标记为垃圾邮件
- 设置SPF记录
- 配置DKIM签名
- 使用可信的发送域名

## 安装依赖

根据选择的邮件服务安装对应依赖：

```bash
# SMTP (nodemailer)
npm install nodemailer @types/nodemailer

# SendGrid
npm install @sendgrid/mail

# AWS SES
npm install @aws-sdk/client-ses
```

## 测试配置

可以通过注册流程测试邮件配置是否正确：

1. 启动应用
2. 尝试注册新账号
3. 检查是否收到验证码邮件
4. 查看控制台日志确认发送状态 